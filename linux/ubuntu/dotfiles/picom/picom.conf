###############################################################################
# Picom Configuration File for Ubuntu Server
###############################################################################
#
# This configuration sets up a basic compositor with:
#   - Backend selection ("xrender" for compatibility; try "glx" if your hardware
#     supports it for better performance)
#   - Vsync enabled to reduce screen tearing
#   - Soft shadows with adjustable radius, offsets, and opacity
#   - Fading animations for smooth transitions
#   - Custom opacity rules for specific applications
#   - Experimental background blur using the dual_kawase method
#
# Save this file as ~/.config/picom.conf (or /etc/xdg/picom.conf for system-wide use)
###############################################################################

# ------------------------------------------------------------------------------
# GENERAL SETTINGS
# ------------------------------------------------------------------------------
# Choose a backend: "xrender" is most compatible, "glx" offers enhanced performance
backend = "xrender"

# Enable vertical synchronization to reduce tearing
vsync = true

# Improve performance by unredirecting fullscreen windows
unredir-if-possible = true

# Allow picom to respect client-specified transparency
detect-client-opacity = true

# ------------------------------------------------------------------------------
# SHADOWS
# ------------------------------------------------------------------------------
shadow = true
shadow-radius = 7
shadow-offset-x = -7
shadow-offset-y = -7
shadow-opacity = 0.7

# Exclude shadows for specific windows/classes
shadow-exclude = [
  "class_g = 'i3-frame'",
  "class_g = 'dmenu'",
  "class_g = 'Conky'",
  "_GTK_FRAME_EXTENTS@:c"
]

# Do not apply shadows to fullscreen windows
shadow-ignore-fullscreen = true

# ------------------------------------------------------------------------------
# FADING
# ------------------------------------------------------------------------------
fading = true
fade-delta = 12
fade-in-step = 0.03
fade-out-step = 0.03

# ------------------------------------------------------------------------------
# OPACITY RULES
# ------------------------------------------------------------------------------
inactive-opacity = 0.9
active-opacity = 1.0
frame-opacity = 0.7

# Application-specific opacity rules (adjust as needed)
opacity-rule = [
  "90:class_g = 'URxvt'",
  "90:class_g = 'XTerm'"
]

# ------------------------------------------------------------------------------
# BLUR (EXPERIMENTAL)
# ------------------------------------------------------------------------------
# Enable background blur (requires compatible GPU/drivers)
blur-background = true
blur-method = "dual_kawase"
blur-strength = 5

# ------------------------------------------------------------------------------
# LOGGING (Optional for Troubleshooting)
# ------------------------------------------------------------------------------
# Uncomment the lines below to enable logging.
# log-level = "warn"
# log-file = "/var/log/picom.log"

# ------------------------------------------------------------------------------
# ADVANCED GLX OPTIONS (For glx backend only)
# ------------------------------------------------------------------------------
# Uncomment if you switch to the glx backend and encounter issues.
# glx-no-stencil = true
# glx-no-rebind-pixmap = true

# ------------------------------------------------------------------------------
# MISC OPTIONS
# ------------------------------------------------------------------------------
# Optionally set the refresh rate (e.g., 60 Hz)
# refresh-rate = 60

###############################################################################
# End of Picom Configuration
###############################################################################